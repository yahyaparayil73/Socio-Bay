{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/d3js/7.8.2/d3.min.js"></script>
    <script src=" https://code.jquery.com/jquery-3.6.4.js"
        integrity="sha256-a9jBBRygX1Bh5lt8GZjXDzyOB+bWve9EiO7tROUtj/E=" crossorigin="anonymous">
        </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
        integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"
        integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="{% static 'style/sign_up.css' %}">
    <title>Sign Up</title>
</head>

<body>
    <section class="vh-100" style="background-color: #a38c8c;">
        <div class="container h-100">
            <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col-lg-12 col-xl-11">
                    <div class="card text-black"
                        style="border-radius: 25px; width: 800px; height:500px; margin-left: auto;margin-right: auto;">
                        <div class="card-body p-md-5" style="height:450px;">
                            <div class="row justify-content-center">
                                <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">

                                    <form class="mx-1 mx-md-4" style="margin-top: -25px;" method="POST" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <div class="form-outline flex-fill mb-0">
                                                <label class="form-label" for="form3Example3c"
                                                    style="line-height: 0px;">User name</label>
                                                <input type="text" id="user_name" name="user_name" class="form-control">
                                                <span style="display: inline; float: right; color: red;"
                                                    id="user_name_error_msg_id"></span>


                                            </div>
                                        </div>

                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <div class="form-outline flex-fill mb-0">
                                                <label class="form-label" for="form3Example3c"
                                                    style="line-height: 0px;">Email</label>
                                                <input type="email" id="user_email" name="user_email"
                                                    class="form-control">
                                                <span style="display: inline; float: right; color: red;"
                                                    id="user_email_error_msg_id"></span>
                                                <span id="email_err"></span>



                                            </div>
                                        </div>

                                        <div class="input-group mb-3">
                                            <input type="file" class="form-control" id="inputGroupFile02"
                                                name="user_image">
                                            <label class="input-group-text" for="inputGroupFile02">Upload</label>
                                        </div>

                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <div class="form-outline flex-fill mb-0">
                                                <label class="form-label" for="form3Example4c" style="line-height: 0px;"
                                                    id="asdffsd">Password</label>
                                                <input type="password" name="user_password" id="user_password"
                                                    class="form-control">
                                                <span style="display: inline; float: right; color: red;"
                                                    id="user_pwd_error_msg_id"></span>

                                            </div>

                                        </div>

                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <div class="form-outline flex-fill mb-0">
                                                <label class="form-label" for="form3Example4cd"
                                                    style="line-height: 0px;">Confirm Password</label>
                                                <input type="password" id="user_confirm_pwd" class="form-control">
                                                <span style="display: inline; float: right; color: red;"
                                                    id="user_confirm_pwd_error_msg_id"></span>

                                            </div>
                                        </div>

                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <label class="form-check-label" for="form2Example3">Already a user ?
                                                <a href="{% url 'user:user_login' %}"
                                                    style="line-height: 0px;">LogIn</a>
                                            </label>
                                        </div>

                                        <div class="d-flex flex-row align-items-center mb-4">
                                            <button type="submit" id="btn_submit" class="btn btn-primary btn-md"
                                                onclick="return signup_validation()">Sign In</button>
                                        </div>
                                    </form>

                                </div>
                                <div class="col-md-10 col-lg-6 col-xl-7 d-block align-items-center order-1 order-lg-2">
                                    <span class="h1 fw-bold mb-0">Socio Bay</span>
                                    <h5 class="fw-normal mb-3 pb-3">Sign In to your account</h5>
                                    <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-registration/draw1.webp"
                                        class="img-fluid" alt="Sample image" style="display: block;">

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>



    <script>

        function signup_validation() {
            // return true;

            var user_name = document.getElementById('user_name').value;                     //value in the input field username is assigned to a variable 'user_name'
            var user_email = document.getElementById('user_email').value;                   //value in the input field email is assigned to a variable 'user_email'
            var user_password = document.getElementById('user_password').value;                  //value in the input field password is assigned to a variable 'user_password'
            var user_confirm_pwd = document.getElementById('user_confirm_pwd').value;       //value in the input field password is assigned to a variable 'user_confirm_password'
            // var regularExpression = /^[a-zA-Z0-9!@#$%^&*]$/;

            let digit = /[0-9]/g;
            var lowercase = /[a-z]/g;
            var uppercase = /[A-Z]/g;
            // alert(user_name, user_email, user_password, user_confirm_pwd)

            if (user_name == "") {                                                          //if nothing is entered in the email field

                document.getElementById('user_name_error_msg_id').innerHTML = "Username must be filled out"; //required error message is inserted to the particular input text
                document.getElementById('user_name').style.border = '1px solid red'                      //to make the input field's border in to reddish colour
                return false;

            } else {

                document.getElementById('user_name_error_msg_id').innerHTML = "";                           //since the condition is false the form gets submitted                      

            }

            if (user_name.length < 8) {                                      //if nothing is entered in the email field

                document.getElementById('user_name_error_msg_id').innerHTML = "must be atleast 8 characters"; //required error message is inserted to the particular input text
                document.getElementById('user_name').style.border = '1px solid red'                      //to make the input field's border in to reddish colour
                return false;

            } else {

                document.getElementById('user_name_error_msg_id').innerHTML = "";                           //since the condition is false the form gets submitted
                document.getElementById('user_name').style.border = ""

            }

            if (user_email == "") {                                                                         //if nothing is entered in the email field

                document.getElementById('user_email_error_msg_id').innerHTML = "User email must be filled out"; //required error message is inserted to the particular input text
                document.getElementById('user_email').style.border = '1px solid red'                       //to make the input field's border in to reddish colour
                return false;                                                                              //to prevent the form from getting submitted

            } else {

                document.getElementById('user_email_error_msg_id').innerHTML = "";                           //since the condition is false the form gets submitted
                document.getElementById('user_email').style.border = ""

            }

            if (user_password == "") {

                document.getElementById('user_pwd_error_msg_id').innerHTML = "Password must be filled out";
                document.getElementById('user_password').style.border = '1px solid red'
                return false;

            } else {

                document.getElementById('user_pwd_error_msg_id').innerHTML = "";

            }

            if (user_password.length < 8) {

                document.getElementById('user_pwd_error_msg_id').innerHTML = "Password must be atleast 8 characters";
                document.getElementById('user_password').style.border = '1px solid red'
                return false;

            } else {

                document.getElementById('user_pwd_error_msg_id').innerHTML = ""

            }

            if (user_password.match(lowercase) && user_password.match(uppercase) && user_password.match(digit)) {

                document.getElementById('user_pwd_error_msg_id').innerHTML = ""
                document.getElementById('user_password').style.border = ""

            } else {

                document.getElementById('user_pwd_error_msg_id').innerHTML = "Password should contain A-Z,a-z and 0-9";
                document.getElementById('user_password').style.border = '1px solid red'
                return false;

            }


            if (user_confirm_pwd == "") {

                document.getElementById('user_confirm_pwd_error_msg_id').innerHTML = "Repeat your password";
                document.getElementById('user_confirm_pwd').style.border = '1px solid red'
                return false;

            } else {

                document.getElementById('user_confirm_pwd_error_msg_id').innerHTML = ""
                document.getElementById('user_confirm_pwd').style.border = ""


            }

            if (user_confirm_pwd != user_password) {

                document.getElementById('user_confirm_pwd_error_msg_id').innerHTML = "Passwords does not match";
                document.getElementById('user_confirm_pwd').style.border = '1px solid red'
                return false;

            } else {

                document.getElementById('user_confirm_pwd_error_msg_id').innerHTML = ""
                document.getElementById('user_confirm_pwd').style.border = ""

            }

        }

        // document.getElementById('show_pwd_check').onclick = function show_pwd() {
        //     if (this.checked) {
        //         document.getElementById('user_pwd').type = "text";
        //     } else {
        //         document.getElementById('user_pwd').type = "password";
        //     }
        // };


        $(document).ready(function () {
            $.ajaxSetup({
                headers: {
                    "X-CSRFToken": $('[name=csrfmiddlewaretoken]').val()
                }
            })
            $('#user_email').change(function () {
                var email = $('#user_email').val()
                $.ajax({
                    type: 'POST',
                    url: '{% url "user:user_email_exist" %}',
                    data: {
                        'email_data': email
                    },
                    success: function (response) {

                        let res = response.email_exist
                        if (res == true) {
                            $('#email_err').html('Email exists')
                            $('#email_err').css('color', 'red')
                            $('#btn_submit').attr('disabled', true)

                        }
                        else {
                            $('#email_err').html(' ')
                            $('#btn_submit').attr('disabled', false)
                        }


                    }
                })

            })
        })
    </script>

</body>

</html>